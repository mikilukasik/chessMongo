<head>
	<link rel="stylesheet" type="text/css" href="chess.css">

	<script src="jquery.js"></script>
	<script src="angular.js"></script>
	<script src="brandNewAi.js"></script>
	<script src="engine.js"></script>

	<script>
	var appModule = angular.module("appModule", []);

	function ApplicationController($scope, $http, $interval, $timeout, $scope) {
		//var sendID=""
		
		$scope.cookieID = ""
			//$scope.gotID=false

		function setCookie(cname, cvalue, exdays) {
			var d = new Date();
			d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000));
			var expires = "expires=" + d.toUTCString();
			document.cookie = cname + "=" + cvalue + "; " + expires;
		}

		function getCookie(cname) {
			var name = cname + "=";
			var ca = document.cookie.split(';');
			for(var i = 0; i < ca.length; i++) {
				var c = ca[i];
				while(c.charAt(0) == ' ') c = c.substring(1);
				if(c.indexOf(name) == 0) return c.substring(name.length, c.length);
			}
			return "";
		}

		$scope.cookieID = getCookie("myCookieID");
		if($scope.cookieID==""){
		
			$scope.sendID=Math.random*100000000
		}else{
			$scope.sendID=$scope.cookieID
		}

		$scope.setID = function(id) {
			setCookie("myCookieID", id, 365)
			$scope.cookieID = id //$scope.gotID=true
			$scope.sendID=id
		}
		
		//$scope.taskNum=0
		
		var longPollTasks=function(){
			
			$http.get('/longPollTasks?id='+$scope.sendID)
				.then(function(response){
					
					//$scope.taskNum=response.data.taskNum
					
					$scope.receivedMessage=response.data.message
					
					
					
					longPollTasks()			//recall for new task
				},function(data){
					//error, retry
					$scope.receivedMessage='error'
					$interval( longPollTasks(),3000)
				})
			
		}
		
		
		
		
		longPollTasks()		//here it starts
		
		
		

	}
	appModule.controller("ApplicationController", ApplicationController);

	</script>
</head>

<body ng-app="appModule" ng-controller="ApplicationController">

	<form ng-if="cookieID==''" ng-submit="setID(thisID)">


		<input id="inputID" ng-model="thisID"></input>


	</form>

	
	
	{{receivedMessage}}

</body>
