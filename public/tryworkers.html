<head>
    <link rel="stylesheet" type="text/css" href="chess.css">

    <script src="jquery.js"></script>
    <script src="angular.js"></script>
    <script src="brandNewAi.js"></script>
    <script src="engine.js"></script>

    <script>
        var appModule = angular.module("appModule", []);

        function ApplicationController($scope, $http, $interval, $timeout) {
            
            $scope.messages=[]
            
            var workersCountConst=32
            
            var mainWorker;
            var subWorkers=new Array(workersCountConst-1) 
            
          
            
                
                function startWorkers() {
                    if(typeof(Worker) !== "undefined") {
                        
                         $scope.workersSupported='Your browser supports HTML5 Web mainWorker.'
                        
                        if(typeof(mainWorker) == "undefined") {
                            mainWorker = new Worker("aiworker.js");
                        }
                        
                        mainWorker.onmessage = function(event) {
                             $scope.messages.push(event.data);
                             $scope.$apply()
                        };
                        //mainWorker should be running, let's start subWorkers
                        //var subWorkersSleeping=workersCountConst
                        var workerToStrart=0
                        while(workerToStrart<workersCountConst){
                            subWorkers[workerToStrart]= new Worker("aiworker.js");
                           
                            
                            //put subworkers listeners here
                            var subWorkerNo=workerToStrart
                            subWorkers[subWorkerNo].onmessage = function(event) {
                                $scope.messages.push(''+subWorkerNo+' '+new Date().getTime()+' '+Math.random()+': '+event.data);
                                $scope.$apply()
                                
                                //check resCommand
                                
                                switch(event.data.resCommand){
                                    
                                    case 'showSpeedTest':
                                    
                                        $scope.messages.push('Speed: '+ event.data.resData)
                                    
                                    break;
                              
                                }
                                
                                
                                
                                
                                
                            };
                            
                             workerToStrart++
                            
                            
                        }
                        console.log('subWorkers should be up and running')
                        
                        //here we have all workers running
                        
                        
                        
                        
                        
                        
                        
                        //first try:
                        mainWorker.postMessage({
                            reqMessgage:'hello',
                            reqCommand:'echo',
                            reqData:'a'
                        })
                        
                         mainWorker.postMessage({
                            reqMessgage:'bullShiting you',
                            reqCommand:'bullShit',
                            reqData:'a'
                        })
                        
                        for(var i=0;i<workersCountConst;i++){
                            subWorkers[i].postMessage({
                                reqMessgage:'hello',
                                reqCommand:'echo',
                                reqData:'no: '+i 
                            })
                        }
                        
                        for(var i=0;i<workersCountConst;i++){
                            subWorkers[i].postMessage({
                                reqMessgage:'test that seed',
                                reqCommand:'speedTest',
                                reqData:{
                                    worker:i
                                }
                            })
                        }
                        
                        
                      
                    } else {
                         $scope.workersSupported='Your browser DOES NOT supports HTML5 Web mainWorker.'
                    }
                }
                
                function stopWorker() { 
                    mainWorker.terminate();
                    mainWorker = undefined;
                }
                
                startWorkers()
        
            
            
            
			
		};
		appModule.controller("ApplicationController", ApplicationController);
	</script>
</head>
<body ng-app="appModule" ng-controller="ApplicationController">

        <div>{{workersSupported}}</div>
        <br>
        <div ng-repeat="x in messages">{{x}}</div>
   






</body>

	