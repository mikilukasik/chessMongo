<head>
    <link rel="stylesheet" type="text/css" href="chess.css">

    <script src="jquery.js"></script>
    <script src="angular.js"></script>
    <script src="brandNewAi.js"></script>
    <script src="engine.js"></script>

    <script>
        var appModule = angular.module("appModule", []);

        function ApplicationController($scope, $http, $interval, $timeout) {
            
            var workersCountConst=32
            
            $scope.sendMessage=function(message){
                $scope.messages.push('@'+ new Date().getTime() +': '+message)
                $scope.$apply()
            }
            
            var startTime=new Date().getTime()
            checkSpeed()
            $scope.mainThreadSpeed=(new Date().getTime()-startTime)*workersCountConst
            
            $scope.messages=[]
            
            
            
            var mainWorker;
            var subWorkers=[] 
            
          
            
                
                function startWorkers() {
                    if(typeof(Worker) !== "undefined") {
                        
                         $scope.workersSupported='Your browser supports HTML5 Web mainWorker.'
                        
                        if(typeof(mainWorker) == "undefined") {
                            mainWorker = new Worker("aiworker.js");
                        }
                        
                        mainWorker.onmessage = function(event) {
                             $scope.sendMessage('')
                             $scope.sendMessage('@'+new Date().getTime()+', main worker event:'+event.data);
                             $scope.sendMessage(' ')
                             
                        };
                        //mainWorker should be running, let's start subWorkers
                        
                        var workerToStrart=0
                        while(workerToStrart<workersCountConst){
                            subWorkers[workerToStrart]= new Worker("aiworker.js");
                           
                            
                            //put subworkers listeners here
                            var subWorkerNo=workerToStrart
                            subWorkers[subWorkerNo].onmessage = function(event) {
                                $scope.sendMessage('@'+new Date().getTime()+', worker: '+event.data.resData.worker+', resData: '+event.data.resData);
                                
                                
                                //check resCommand
                                
                                switch(event.data.resCommand){
                                    
                                    case 'speedTest':
                                    
                                        $scope.sendMessage('Speed: '+ event.data.resData.speed + ', worker '+ event.data.resData.worker)
                                        $scope.pendingSpeedTest--
                                        console.log($scope.pendingSpeedTest)
                                        if($scope.pengingSpeedTest==0){
                                            $scope.sendMessage('Speedtest done.')
                                        }
                                        
                                    break;
                              
                                }
                                
                                
                                
                                
                                
                            };
                            
                             workerToStrart++
                            
                            
                        }
                        console.log('subWorkers should be up and running')
                        
                        //here we have all workers running
                        
                        
                        
                        
                        
                        
                        
                        //first try:
                        mainWorker.postMessage({
                            reqMessgage:'hello',
                            reqCommand:'echo',
                            reqData:{worker:'main'}
                        })
                        
                        //  mainWorker.postMessage({
                        //     reqMessgage:'bullShiting you',
                        //     reqCommand:'bullShit',
                        //     reqData:{worker:'main'}
                        // })
                        
                        // for(var i=0;i<workersCountConst;i++){
                        //     subWorkers[i].postMessage({
                        //         reqMessgage:'hello',
                        //         reqCommand:'echo',
                        //         reqData:'no: '+i 
                        //     })
                        // }
                        
                        $scope.pendingSpeedTest=0
                        for(var i=0;i<workersCountConst;i++){
                            $scope.pendingSpeedTest++
                            subWorkers[i].postMessage({
                                reqMessgage:'test that seed',
                                reqCommand:'speedTest',
                                reqData:{
                                    worker:i
                                }
                            })
                        }
                        
                        
                      
                    } else {
                         $scope.workersSupported='Your browser DOES NOT supports HTML5 Web mainWorker.'
                    }
                }
                
                function stopWorker() { 
                    mainWorker.terminate();
                    mainWorker = undefined;
                }
                
                startWorkers()
        
            
            
            
			
		};
		appModule.controller("ApplicationController", ApplicationController);
	</script>
</head>
<body ng-app="appModule" ng-controller="ApplicationController">
    
        <div>Main thread speed: {{mainThreadSpeed}}</div>
        <div>Workers speed: {{workersSpeed}}</div>
        

        <div>{{workersSupported}}</div>
        <br>
        <div ng-repeat="x in messages">{{x}}</div>
   






</body>

	